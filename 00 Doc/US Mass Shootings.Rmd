---
title: "<center><b>US Mass Shootings Analysis and Visualizations</b></center>"
author: "<center><b>Derry Xu, Jackie Rambo, Stanley Chi, Zihao Zhang</b></center>"
output:
  html_notebook:
    toc: yes
    depth: 2
---
<center>![](memorial.jpg)</center>

#**Introduction**

For Project 5, we clean three datasets in RStudio with regular expression and loops, using the ***US Mass Shootings***, ***US States*** and ***DHS City Location Example*** datasets that are downloaded from data.world/awram, data.world/markmarkoh and data.world/bryon, respectively. Using shiny app from RStudio and the Tableau software, we visualize the relations between mass shootings in the US, race of the shooters, numbers of fatalities and victims, and the location types.



#**R Configuration**
Below we display our sessionInfo.

```{r sessionInfo}
sessionInfo(package=NULL)
```

#**Dataset**

###**Accessing raw dataset from the _data.world_**

From these urls: _US Mass Shootings_ https://data.world/awram/us-mass-shootings, _US State Table_ https://data.world/markmarkoh/us-state-table, _DHS City Location Example_ https://data.world/bryon/dhs-city-location-example, we download our raw datasets and access them by queries through _data.world_ server.

###**Download cleaned dataset from _data.world_**

From this url: https://data.world/andyzhang/final-project, invited persons are able to access to a private data under the user name _andyzhang_. Corresponding to the dataset description, there are two cleaned files there called MassShooting, StateAbbrev and LatLong.

#**Data Cleaning**

```{r}
source("../01 Data/ETL.R")
```

###**A Summary of Dataset**

```{r}
print(summary(MassShooting))
```

```{r}
print(summary(StateAbbrev))
```

```{r}
print(summary(LatLong))
```

This is a summary of all the dimensions and measures of our county demographics and poverty data. A sample of 7 entries are shown for each column.

###**The Dimensions of Dataset**

```{r}
print(head(MassShooting[MSdimensions]))
```

```{r}
print(head(StateAbbrev[SAdimensions]))
```

```{r}
print(head(LatLong[LLdimensions]))
```

Dimensions are typically items that are non-numerical attributes. In this case, our dimensions consist of: **Case**, **Gender** , **Race**, **City**, **State**, **Location Type**, **Mental Illness**, **Legal Weapon**, and **Abbreviation**.

###**The Measures of Dataset**

```{r}
print(head(MassShooting[MSmeasures]))
```

```{r}
print(head(LatLong[LLmeasures]))
```

Measures are typically items that are quantified numerically (i.e. ints or doubles). In this case, our measures consist of: **Year**, **Fatalities**, **Wounded**, **Total Victims**,**Number of Weapons**, **Latitude**, and **Longitude**.

#**Shiny**
###**Shiny Website**
<iframe src="https://andyzihaozhang.shinyapps.io/project6/" style="border: none; width: 900px; height: 900px"></iframe>

This shows an example of how data points can be selected using the Shiny app and then depicted in a new underlying plot. Using SQL and ggplot, we made boxplots, histograms, scatter plots, crosstabs, and barcharts in Shiny that produce the same visualizations as the Tableau visualizations below.

#**Visualization**
Below we display our visualizations of the dataset.

###**Visualization 1**

<center>![](boxplot.png)</center>

The following is a bar chart of certain races in counties versus the poverty rate (as a percentage). The races are African American, AIAN (American Indian and Alaskan Native), Asian, Latino, Multiple, NHOPI (Native Hawaiians and Other Pacific Islanders), “Other”, and White. There races are individually measured for their poverty rate in each county (some race poverty data is not available for certain counties). The poverty rate is a calculated percentage from the total population and the impoverished population. The reference line for each county set represents the window average (or just average for that county). Each bar is also color-coded on a poverty rate gradient to help visually distinguish between different values. From this visualization, we have realized some interesting observations, such as huge differences in poverty rates based on race in places such as Amador or Colusa.

###**Visualization 2**

<center>![](histogram.png)</center>

Poverty Rate by County
X = County, Y= Poverty Rate

This is a bar graph showing the poverty ratio in every county in California. This visualization distinguishes counties with high/low poverty rates from the rest. Fresno appears to have the highest poverty rate while Placer has the lowest. This bar graph is also useful in creating sets separating counties with high poverty rates from others by highlighting across all counties within the desired range of poverty rate.

###**Visualization 3**
<center>![](scatterplot.png)</center>

These three maps depict concentrations of populations based on race. The first 
map represents counties containing the populations with the highest povety levels.
The second corresponds to the counties with populations with medium poverty levels, and the third represents counties with populations with low levels of poverty. As shown, high poverty levels are distributed down the middle of California, running north to south, and low levels are concentrated in the middle running east to west. Medium poverty levels are distributed throughout, but with more being concentrated in the upper half section of California.

###**Visualization 4**
<center>![](Crosstabs.png)</center>

###**Visualization 5**
<center>![](Barcharts.png)</center>

###**Visualization 6**
<center>![](Map.png)</center>

#**Instructions on Creating the Visualizations on Tableau**
###**Boxplot**
To create this visualization, we dragged *Race* to Columns and *TotalVictims* to Rows. If *sum(TotalVictims)* is in Rows, turn off Aggregate Measures by clicking on Analysis and uncheck Aggregate Measures.

<center>![vis1](how2box.png)</center>

###**Histogram**
The histogram below was created by first generating bins by right-clicking *NumWeapons* -> Create -> Bins. Set the bin width to 1. Drag the newly created bins to Columns. Drag *NumWeapons* to Rows. Right-click *NumWeapons* -> Measure -> Count. We filtered by dragging *MentalIllness* and *LegalWeapon* to Filters and selecting True for both.
<center>![vis2](how2hist.png)</center>

###**Scatterplot**
The scatterplot was made by dragging *Fatalities* to Columns and *NumWeapons* to Rows. *LocationType* is dragged to Color to fill each circle with color of the corresponding location type.
<center>![vis3](how2scat.png)</center>

###**Crosstabs**
The crosstabs were made by dragging *LocationType* to Columns and *State* to Rows. *TotalVictims* was dragged to Text. We colored the text with a calculated field, *Fatal Rate*. The image below shows the calculation. 
<center>![calc](fatalcalc.png)</center>
In order to group the fatal rates into low, medium, and high categories, we created parameters such as the one below. Low ranged from 0 to 0.5. Medium ranged from 0.5 to 0.7. and High ranged from 0.7 to 1.
<center>![param](fatalparam.png)</center>
A new field, *Fatal Rate 2* was created to assign each fatal rate to a qualitative measure rather than quantitative. The calculation is shown below.
<center>![calc2](fatalcalc2.png)</center>
*Fatal Rate 2* is dragged to Color. We also filtered out the Other type by dragging *LocationType* to Filters and deselecting Other.
<center>![vis4](how2x.png)</center>

###**Barcharts**
The barcharts were made by dragging *TotalVictims* to Columns, and *Race* and *LocationType* to Rows. Average lines were inserted by clicking on the Analytics Tab and double clicking on Average Line.
<center>![vis5](how2bar.png)</center>

###**Map**
This map was made by converting *Latitude* and *Longitude* to geographic types by right-clicking them -> Geographic Role -> Latitude (Longitude), then dragging them to Rows and Columns, respectively. We filtered out years when the number of fatalities totaled less than 35, by dragging Year to Filters and selecting 1999, 2007, 2009, and 2012. To add information to the data points, we dragged *City*, *State*, and *Case* to Detail. We varied the sizes of each point by dragging *Fatalities* to Size.
<center>![vis6](how2map.png)</center>



